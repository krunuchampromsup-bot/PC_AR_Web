<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π - SmartCom</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --pink-neon: #ff00cc;
            --bg-dark: #f4f7f6;
        }

        body { 
            font-family: 'Prompt', sans-serif; 
            background: var(--bg-dark); 
            padding: 10px; 
            margin: 0;
        }

        .admin-card { 
            background: white; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            max-width: 900px; 
            margin: 20px auto; 
        }

        .header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        h2 { margin: 0; color: #333; font-size: 1.4rem; }

        .btn-delete { 
            background: #ff4d4d; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold;
            transition: 0.3s;
        }
        
        .btn-delete:hover { background: #e60000; transform: scale(1.05); }

        .status-bar {
            background: #e0fbfc;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #005f73;
            font-weight: bold;
        }

        /* --- ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û --- */
        .table-container { overflow-x: auto; }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            background: white;
            min-width: 500px;
        }

        th, td { 
            padding: 15px; 
            text-align: center; 
            border-bottom: 1px solid #eee; 
        }

        th { 
            background-color: var(--neon-blue); 
            color: #000; 
            font-weight: 600;
        }

        tr:nth-child(even) { background-color: #f9f9f9; }
        
        tr:hover { background-color: #f1fdff; }

        /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        @media (max-width: 600px) {
            h2 { font-size: 1.1rem; }
            .btn-delete { width: 100%; order: 2; }
            .header-flex { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>

    <div class="admin-card">
        <div class="header-flex">
            <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (‡∏Ñ‡∏£‡∏π‡∏ô‡∏∏‡∏ä)</h2>
            <button class="btn-delete" onclick="resetScores()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>

        <div class="status-bar">
            ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß: <span id="student-count">0</span> ‡∏Ñ‡∏ô
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                        <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (10)</th>
                        <th>‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</th>
                    </tr>
                </thead>
                <tbody id="admin-table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // ‚úÖ 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å quiz.html)
        const firebaseConfig = {
            apiKey: "AIzaSyAK5UMFATyhnQlq3EDLmG7agFqTKh0BYCM",
            authDomain: "smartcom-ar-quiz.firebaseapp.com",
            projectId: "smartcom-ar-quiz",
            storageBucket: "smartcom-ar-quiz.appspot.com",
            messagingSenderId: "367243958931", 
            appId: "1:367243958931:web:3e3c66f54668b8ec66b8ec" 
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ‚úÖ 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏î‡∏∂‡∏á‡∏ó‡∏±‡πâ‡∏á Firebase ‡πÅ‡∏•‡∏∞ LocalStorage)
        function loadScores() {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase ‡πÅ‡∏ö‡∏ö Real-time
            database.ref('scores/').orderByChild('score').on('value', (snapshot) => {
                const tbody = document.getElementById('admin-table-body');
                const firebaseList = [];
                
                snapshot.forEach((child) => {
                    firebaseList.push(child.val());
                });
                
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage ‡∏°‡∏≤‡∏ú‡∏™‡∏° (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡πá‡∏ï)
                const localList = JSON.parse(localStorage.getItem('studentScores')) || [];
                
                // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ)
                // ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≤‡∏Å Firebase ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
                renderTable(firebaseList.length > 0 ? firebaseList.reverse() : localList.reverse());
            });
        }

        // ‚úÖ 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        function renderTable(list) {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = "";
            
            list.forEach((item, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td style="text-align: left; padding-left: 30px;">${item.name}</td>
                        <td style="font-weight: bold; color: #2ecc71;">${item.score}</td>
                        <td>${item.time}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            document.getElementById('student-count').innerText = list.length;
        }

        // ‚úÖ 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ó‡∏µ‡πà)
        function resetScores() {
            if(confirm("‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?\n(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)")) {
                // ‡∏•‡∏ö‡πÉ‡∏ô Firebase
                database.ref('scores/').remove();
                // ‡∏•‡∏ö‡πÉ‡∏ô LocalStorage
                localStorage.removeItem('studentScores');
                alert("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                location.reload();
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.onload = loadScores;
    </script>
</body>
</html>
